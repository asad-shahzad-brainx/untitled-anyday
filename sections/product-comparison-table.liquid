{{ 'product-comparison-table.css' | asset_url | stylesheet_tag }}

{%- assign section_order = product.metafields.comparison_chart_section.section_order | default: 19 -%}

{%- assign enable_section = section.settings.enable_section -%}
{%- assign hide_section = product.metafields.comparison_chart_section.hide_section -%}
{%- assign heading = section.settings.heading -%}
{%- assign text_color = section.settings.text_color | default: '#000'-%}
{%- assign bg_color = section.settings.bg_color | default: '#fff' -%}
{%- assign row_label_1 = section.settings.row_label_1 -%}
{%- assign row_label_2 = section.settings.row_label_2 -%}
{%- assign row_label_3 = section.settings.row_label_3 -%}
{%- assign row_label_4 = section.settings.row_label_4 -%}
{%- assign row_label_5 = section.settings.row_label_5 -%}
{%- assign row_label_6 = section.settings.row_label_6 -%}
{%- assign row_label_7 = section.settings.row_label_7 -%}

{%- assign padding_top_desk = section.settings.padding_top_desk -%}
{%- assign padding_bottom_desk = section.settings.padding_bottom_desk -%}
{%- assign padding_top_mob = section.settings.padding_top_mob -%}
{%- assign padding_bottom_mob = section.settings.padding_bottom_mob -%}
{%- assign show_bottom_wave = section.settings.show_bottom_wave -%}

{%- if enable_section and hide_section != 'true' -%}
  <section class="product-comparison-table" style="
          --padding-top-desktop: {{ padding_top_desk }}px;
          --padding-bottom-desktop: {{ padding_bottom_desk }}px;
          --padding-top-mobile: {{ padding_top_mob }}px;
          --padding-bottom-mobile: {{ padding_bottom_mob }}px;
          --bg-color: {{ bg_color }};
          --text-color: {{ text_color  }};
          ">

    {%- if show_bottom_wave -%}
      {%- render 'waves' with 'wave-bottom-reverse' -%}
    {%- endif -%}

    <div class="product-table__wrapper">

      {%- if heading != blank -%}
        <h2 class="product-table__heading">{{ heading }}</h2>
      {%- endif -%}

      {%- if section.blocks.size > 0 -%}
        <table class="products-table">

          <thead>
            <tr>
              <th class="product-table__label text-right">{{ row_label_1 }}</th>
              {%- for block in section.blocks -%}
                {%- assign product = all_products[block.settings.product] -%}
                <th class="product-table__label">
                  {{ product.title }}
                </th>
              {%- endfor -%}
            </tr>
          </thead>

          <tbody>
            <tr>
              <th class="product-table__label text-right">{{ row_label_2 }}</th>
              {%- for block in section.blocks -%}
                {%- assign image_row_1 = block.settings.image_row_1 -%}
                {%- assign text_row_1 = block.settings.text_row_1 -%}
                {%- assign row_bg_color = block.settings.row_bg_color -%}
                {%- assign row_text_color = block.settings.row_text_color -%}

                <style>
                    .table-td--bg-{{ block.id }} {
                        background-color: {{ row_bg_color }};
                        color: {{ row_text_color }};
                    }
                </style>

                <td class="table-td--bg-{{ block.id }}">
                  {%- if image_row_1 != blank -%}
                    <img src="{{ image_row_1 | img_url: 'master' }}" alt="{{ image_row_1.alt }}">
                  {%- endif -%}

                  {%- if text_row_1 != blank -%}
                    <span>{{ text_row_1 }}</span>
                  {%- endif -%}
                </td>
              {%- endfor -%}
            </tr>
            <tr>
              <th class="product-table__label text-right">{{ row_label_3 }}</th>
              {%- for block in section.blocks -%}
                {%- assign image_row_2 = block.settings.image_row_2 -%}
                {%- assign text_row_2 = block.settings.text_row_2 -%}

                <td class="table-td--bg-{{ block.id }}">
                  {%- if image_row_2 != blank -%}
                    <img src="{{ image_row_2 | img_url: 'master' }}" alt="{{ image_row_2.alt }}">
                  {%- endif -%}

                  {%- if text_row_2 != blank -%}
                    <span>{{ text_row_2 }}</span>
                  {%- endif -%}
                </td>
              {%- endfor -%}
            </tr>
            <tr>
              <th class="product-table__label text-right">{{ row_label_4 }}</th>
              {%- for block in section.blocks -%}
                {%- assign image_row_3 = block.settings.image_row_3 -%}
                {%- assign text_row_3 = block.settings.text_row_3 -%}

                <td class="table-td--bg-{{ block.id }}">
                  {%- if image_row_3 != blank -%}
                    <img src="{{ image_row_3 | img_url: 'master' }}" alt="{{ image_row_3.alt }}">
                  {%- endif -%}

                  {%- if text_row_3 != blank -%}
                    <span>{{ text_row_3 }}</span>
                  {%- endif -%}
                </td>
              {%- endfor -%}
            </tr>
            <tr>
              <th class="product-table__label text-right">{{ row_label_5 }}</th>
              {%- for block in section.blocks -%}
                {%- assign image_row_4 = block.settings.image_row_4 -%}
                {%- assign text_row_4 = block.settings.text_row_4 -%}

                <td class="table-td--bg-{{ block.id }}">
                  {%- if image_row_4 != blank -%}
                    <img src="{{ image_row_4 | img_url: 'master' }}" alt="{{ image_row_4.alt }}">
                  {%- endif -%}

                  {%- if text_row_4 != blank -%}
                    <span>{{ text_row_4 }}</span>
                  {%- endif -%}
                </td>
              {%- endfor -%}
            </tr>
            <tr>
              <th class="product-table__label text-right">{{ row_label_6 }}</th>
              {%- for block in section.blocks -%}
                {%- assign product = all_products[block.settings.product] -%}
                {%- assign text = block.settings.text_row_5 -%}


                <td class="table-td--bg-{{ block.id }}">
                  {{ product.price | money_without_trailing_zeros }}
                  <div class="product-table__text">{{ text }}</div>
                </td>
              {%- endfor -%}
            </tr>
          </tbody>

          <tfoot>
            <tr>
              <th class="product-table__label text-right">{{ row_label_7 }}</th>
              {%- for block in section.blocks -%}
                {%- assign product = all_products[block.settings.product] -%}
                <td>
                  {% if product.available %}
                    {%- capture product_form_id -%}QuickAddProductForm-{{ section_id }}-{{ product.id }}{%- endcapture -%}
                    {%- form 'product', product, is: 'product-form', id: product_form_id -%}
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
                      {%- liquid
                        if product.template_suffix != 'pre-order'
                          assign quick_add_label = 'products.product.add_to_cart' | t
                        else
                          assign quick_add_label = 'products.product.pre_order' | t
                        endif
                      -%}
                      <button type="submit" class="button button--primary pointer-events-auto" is="hover-button" data-variant-id="{{ product.selected_or_first_available_variant.id }}" aria-label="{{ quick_add_label | escape }}">
                        <span class="btn-fill" data-fill></span>
                        <span class="btn-text">
                          <span class="hidden md:block" data-sold-out="{{ 'products.product.sold_out' | t | escape }}">
                            {{- quick_add_label -}}
                          </span>
                        </span>
                      </button>
                    {%- endform -%}
                  {% else %}
                    <a class="anyday-btn anyday-btn__sold-out" href="{{ product.url | within: collection }}">
                      {{ 'products.product.sold_out' | t }}
                    </a>
                  {% endif %}
                </td>
              {%- endfor -%}
            </tr>
          </tfoot>
        </table>


        <div class="products-table-tabs">
          <ul class="products-tabs__nav">
            {%- for block in section.blocks -%}
              {%- assign product = all_products[block.settings.product] -%}

              <li class="products-tabs__nav-item {% if forloop.first %}active{% endif %}">
                {{ product.title }}
              </li>
            {%- endfor -%}
          </ul>

          <ul class="products-tabs__content">
            <li class="products-tabs__item">
              <div class="products-tabs__item-label">{{ row_label_2 }}</div>

              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign image_row_1 = block.settings.image_row_1 -%}
                  {%- assign text_row_1 = block.settings.text_row_1 -%}

                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {%- if image_row_1 != blank -%}
                      <img src="{{ image_row_1 | img_url: 'master' }}" alt="{{ image_row_1.alt }}">
                    {%- endif -%}

                    {%- if text_row_1 != blank -%}
                      <span>{{ text_row_1 }}</span>
                    {%- endif -%}
                  </div>
                {% endfor %}
              </div>
            </li>

            <li class="products-tabs__item">
              <div class="products-tabs__item-label">{{ row_label_3 }}</div>

              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign image_row_2 = block.settings.image_row_2 -%}
                  {%- assign text_row_2 = block.settings.text_row_2 -%}

                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {%- if image_row_2 != blank -%}
                      <img src="{{ image_row_2 | img_url: 'master' }}" alt="{{ image_row_2.alt }}">
                    {%- endif -%}

                    {%- if text_row_2 != blank -%}
                      <span>{{ text_row_2 }}</span>
                    {%- endif -%}
                  </div>
                {% endfor %}
              </div>
            </li>

            <li class="products-tabs__item">
              <div class="products-tabs__item-label">{{ row_label_4 }}</div>

              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign image_row_3 = block.settings.image_row_3 -%}
                  {%- assign text_row_3 = block.settings.text_row_3 -%}

                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {%- if image_row_3 != blank -%}
                      <img src="{{ image_row_3 | img_url: 'master' }}" alt="{{ image_row_3.alt }}">
                    {%- endif -%}

                    {%- if text_row_3 != blank -%}
                      <span>{{ text_row_3 }}</span>
                    {%- endif -%}
                  </div>
                {% endfor %}
              </div>
            </li>

            <li class="products-tabs__item">
              <div class="products-tabs__item-label">{{ row_label_5 }}</div>

              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign image_row_4 = block.settings.image_row_4 -%}
                  {%- assign text_row_4 = block.settings.text_row_4 -%}

                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {%- if image_row_4 != blank -%}
                      <img src="{{ image_row_4 | img_url: 'master' }}" alt="{{ image_row_4.alt }}">
                    {%- endif -%}

                    {%- if text_row_4 != blank -%}
                      <span>{{ text_row_4 }}</span>
                    {%- endif -%}
                  </div>
                {% endfor %}
              </div>
            </li>

            <li class="products-tabs__item">
              <div class="products-tabs__item-label">{{ row_label_6 }}</div>

              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign product = all_products[block.settings.product] -%}
                  {%- assign text = block.settings.text_row_5 -%}

                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {{ product.price | money_without_trailing_zeros }}
                    <div class="product-table__text">{{ text }}</div>
                  </div>
                {% endfor %}
              </div>
            </li>

            <li class="products-tabs__item">
              <div class="products-tabs__item-content">
                {%- for block in section.blocks -%}
                  {%- assign product = all_products[block.settings.product] -%}
                  <div class="item-content__inner {% if forloop.first %}active{% endif %}">
                    {% if product.available %}
                      {%- capture product_form_id -%}QuickAddProductForm-{{ section.id }}-{{ product.id }}{%- endcapture -%}
                      {%- form 'product', product, is: 'product-form', id: product_form_id -%}
                        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
                        {%- liquid
                          if product.template_suffix != 'pre-order'
                            assign quick_add_label = 'products.product.add_to_cart' | t
                          else
                            assign quick_add_label = 'products.product.pre_order' | t
                          endif
                        -%}
                        <button type="submit" class="button button--primary pointer-events-auto md:opacity-0" is="hover-button" data-variant-id="{{ product.selected_or_first_available_variant.id }}" aria-label="{{ quick_add_label | escape }}">
                          <span class="btn-fill" data-fill></span>
                          <span class="btn-text">
                            <span class="hidden md:block" data-sold-out="{{ 'products.product.sold_out' | t | escape }}">
                              {{- quick_add_label -}}
                            </span>
                          </span>
                        </button>
                      {%- endform -%}
                    {% else %}
                      <a class="anyday-btn anyday-btn__sold-out" href="{{ product.url | within: collection }}">
                        {{ 'products.product.sold_out' | t }}
                      </a>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </li>
          </ul>
        </div>
      {% endif %}
    </div>
  </section>
{%- endif -%}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const section = document.querySelector("#shopify-section-{{ section.id }}");
    const buttons = section.querySelectorAll(".products-tabs__nav-item");
    const contentWrapper = section.querySelectorAll(".products-tabs__item-content");
    const contentItems = section.querySelectorAll(".item-content__inner");

    buttons.forEach(function(button, index) {
      button.addEventListener("click", function() {
        if (!button.classList.contains("active")) {
          buttons.forEach(function(btn) {
            btn.classList.remove("active");
          });
          button.classList.add("active");

          contentWrapper.forEach(function(wrapper) {
            const items = wrapper.querySelectorAll(".item-content__inner");
            items.forEach(function(item) {
              item.classList.remove("active");
            });
            items[index].classList.add("active");
          });
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product comparison chart",
  "max_blocks": 6,
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_section",
      "label": "Enable section"
    },
    {
      "type": "header",
      "content": "Section paddings"
    },
    {
      "type": "range",
      "id": "padding_top_desk",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top desktop",
      "default": 75
    },
    {
      "type": "range",
      "id": "padding_bottom_desk",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom desktop",
      "default": 75
    },
    {
      "type": "range",
      "id": "padding_top_mob",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top mobile",
      "default": 35
    },
    {
      "type": "range",
      "id": "padding_bottom_mob",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom mobile",
      "default": 0
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#F1EDE7"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000"
    },
    {
      "type": "header",
      "content": "Rows label"
    },
    {
      "type": "text",
      "id": "row_label_1",
      "label": "Label 1"
    },
    {
      "type": "text",
      "id": "row_label_2",
      "label": "Label 2"
    },
    {
      "type": "text",
      "id": "row_label_3",
      "label": "Label 3"
    },
    {
      "type": "text",
      "id": "row_label_4",
      "label": "Label 4"
    },
    {
      "type": "text",
      "id": "row_label_5",
      "label": "Label 5"
    },
    {
      "type": "text",
      "id": "row_label_6",
      "label": "Label 6"
    },
    {
      "type": "text",
      "id": "row_label_7",
      "label": "Label 7"
    },
    {
      "type": "checkbox",
      "id": "show_bottom_wave",
      "label": "Show bottom wave",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "block",
      "name": "Block",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "color",
          "id": "row_bg_color",
          "label": "Background color",
          "default": "#F1EDE7"
        },
        {
          "type": "color",
          "id": "row_text_color",
          "label": "Text color",
          "default": "#000000"
        },
        {
          "type": "header",
          "content": "Row 1"
        },
        {
          "type": "image_picker",
          "id": "image_row_1",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "text_row_1",
          "label": "Text"
        },
        {
          "type": "header",
          "content": "Row 2"
        },
        {
          "type": "image_picker",
          "id": "image_row_2",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "text_row_2",
          "label": "Text"
        },
        {
          "type": "header",
          "content": "Row 3"
        },
        {
          "type": "image_picker",
          "id": "image_row_3",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "text_row_3",
          "label": "Text"
        },
        {
          "type": "header",
          "content": "Row 4"
        },
        {
          "type": "image_picker",
          "id": "image_row_4",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "text_row_4",
          "label": "Text"
        },
        {
          "type": "header",
          "content": "Row 5 (price)"
        },
        {
          "type": "text",
          "id": "text_row_5",
          "label": "Text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product comparison chart"
    }
  ]
}
{% endschema %}